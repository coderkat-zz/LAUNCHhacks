<head>
    <script src="http://code.jquery.com/jquery-1.9.1.js">

    </script>
</head>

{% block content %}
<h1>Welcome to WhateverNameWePick</h1>
<h2>Sign in with Foursquare!</h2>
<article></article>


{% endblock %}

<script>
var clientId = '{{ client_id }}',
    clientSecret = '{{ client_secret }}';
// look for an access token in the query string
uri = window.location.href;
search = '#access_token=';
start = uri.indexOf(search);
access_token = false;

if (start > 0) {
    start = start + search.length
    access_token = uri.slice(start);
}

if(access_token){
    $.ajax({
        url:'https://api.foursquare.com/v2/users/self',
        data: {oauth_token:access_token},
        success:function(user_data) {
            user_data = user_data.response.user
            $.ajax({
                type: 'POST',
                url: 'http://localhost:5000/index',
                data: JSON.stringify({'user_data':user_data, 'access_token':access_token}),
                dataType: JSON,
                contentType: 'application/json;charset=UTF-8'
            })
        },
        error: function(jqXHR, textStatus, errorThrown){
            console.error(errorThrown);
        }
    });
} else {
    // print a login button
    client_id = clientId
    redirect_uri = 'http://localhost:5000/index';
    auth_url = 'https://foursquare.com/oauth2/authenticate?client_id=' + client_id + '&response_type=token&redirect_uri=' + redirect_uri;
    $('article').html('<a href="' + auth_url + '" target=""><img src="https://playfoursquare.s3.amazonaws.com/press/logo/connect-blue@2x.png"></a>');
}
</script>